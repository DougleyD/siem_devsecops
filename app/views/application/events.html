{% extends "application/base.html" %}

{% block style %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/events.css') }}">
{% endblock %}

{% block section %}
<div class="filter-line">
   <div class="filter-content">
      <form id="filter-form">
         <div class="icon-search">
            <i class="fa-solid fa-magnifying-glass"></i>
         </div>
         <input type="text" id="search-input" placeholder="Search by field" />
         <select id="agent-select">
            <option value="">All agents</option>
            <option value="Agent1">Agent 1</option>
            <option value="Agent2">Agent 2</option>
            <option value="Agent3">Agent 3</option>
            <option value="Agent4">Agent 4</option>
         </select>
         
         <select id="sort-select">
            <option value="time_asc">Newest first</option>
            <option value="time_desc">Oldest first</option>
            <option value="agent_asc">Agent ID (A-Z)</option>
            <option value="agent_desc">Agent ID (Z-A)</option>
            <option value="severity">Severity (High first)</option>
         </select>
      </form>
   </div>
</div>

<div class="title-line">
   <div class="title-info">
      <button class="title-bttn"><i class="fa-solid fa-chart-simple"></i></button>
      <div class="field-time">Timestamp</div>
      <div class="field-event">Event ID</div>
      <div class="field-agent">Agent ID</div>
      <div class="field-host">Hostname</div>
      <div class="field-ip">IP</div>
      <div class="field-desc">Message</div>
      <div class="field-cat">Category</div>
   </div>
</div>

<div class="events-container">
   <!-- Event 1 -->
   <div class="event-line">
      <div class="resume-info">
         <button class="field-bttn"><i class="fa-solid fa-chevron-right"></i></button>
         <div class="field-time">2023-05-15 14:30:22</div>
         <div class="field-event">1495</div>
         <div class="field-agent">00100</div>
         <div class="field-host">Daniel</div>
         <div class="field-ip">192.168.31.134</div>
         <div class="field-desc">Authentication failure</div>
         <div class="field-cat">SSH failed</div>
      </div>
   </div>
   <div class="complete-line">
      <div class="complete-info">
         <!-- Full Status Column -->
         <div class="complete-column">
            <div class="column-header">Full Status</div>
            <div class="scrollable-content">
               <div class="complete-field"><span class="field-label">User:</span> daniel</div>
               <div class="complete-field"><span class="field-label">File directory:</span> /home/daniel/Documents</div>
               <div class="complete-field"><span class="field-label">Service:</span> SSH</div>
               <div class="complete-field"><span class="field-label">Port:</span> 22</div>
               <div class="complete-field"><span class="field-label">Directory:</span> N/A</div>
               <div class="complete-field"><span class="field-label">Authentication:</span> Failed (3 attempts)</div>
               <div class="complete-field"><span class="field-label">Web:</span> N/A</div>
            </div>
         </div>
         
         <!-- JSON Column -->
         <div class="complete-column json-column">
            <div class="column-header">JSON</div>
            <div class="scrollable-content">
               <pre>{
     "event": {
       "timestamp": "2023-05-15T14:30:22Z",
       "id": 1495,
       "type": "authentication",
       "outcome": "failure"
     },
     "agent": {
       "id": "00100",
       "hostname": "Daniel",
       "ip": "192.168.31.134"
     },
     "details": {
       "user": "daniel",
       "directory": "/home/daniel/Documents",
       "service": "SSH",
       "port": 22,
       "authentication": {
         "status": "failed",
         "attempts": 3
       }
     }
   }</pre>
            </div>
         </div>
      </div>
   </div>

   <!-- Event 2 -->
   <div class="event-line">
      <div class="resume-info">
         <button class="field-bttn"><i class="fa-solid fa-chevron-right"></i></button>
         <div class="field-time">2023-05-15 14:30:22</div>
         <div class="field-event">1495</div>
         <div class="field-agent">00100</div>
         <div class="field-host">Daniel</div>
         <div class="field-ip">192.168.31.134</div>
         <div class="field-desc">Authentication failure</div>
         <div class="field-cat">SSH failed</div>
      </div>
   </div>
   <div class="complete-line">
      <div class="complete-info">
         <!-- Full Status Column -->
         <div class="complete-column">
            <div class="column-header">Full Status</div>
            <div class="scrollable-content">
               <div class="complete-field"><span class="field-label">User:</span> daniel</div>
               <div class="complete-field"><span class="field-label">File directory:</span> /home/daniel/Documents</div>
               <div class="complete-field"><span class="field-label">Service:</span> SSH</div>
               <div class="complete-field"><span class="field-label">Port:</span> 22</div>
               <div class="complete-field"><span class="field-label">Directory:</span> N/A</div>
               <div class="complete-field"><span class="field-label">Authentication:</span> Failed (3 attempts)</div>
               <div class="complete-field"><span class="field-label">Web:</span> N/A</div>
            </div>
         </div>
         
         <!-- JSON Column -->
         <div class="complete-column json-column">
            <div class="column-header">JSON</div>
            <div class="scrollable-content">
               <pre>{
     "event": {
       "timestamp": "2023-05-15T14:30:22Z",
       "id": 1495,
       "type": "authentication",
       "outcome": "failure"
     },
     "agent": {
       "id": "00100",
       "hostname": "Daniel",
       "ip": "192.168.31.134"
     },
     "details": {
       "user": "daniel",
       "directory": "/home/daniel/Documents",
       "service": "SSH",
       "port": 22,
       "authentication": {
         "status": "failed",
         "attempts": 3
       }
     }
   }</pre>
            </div>
         </div>
      </div>
   </div>
</div>
{% endblock %}

{% block script %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Toggle complete information
  document.querySelectorAll('.field-bttn').forEach(button => {
    button.addEventListener('click', function() {
      const eventLine = this.closest('.event-line');
      const completeLine = eventLine.nextElementSibling;
      
      if (completeLine && completeLine.classList.contains('complete-line')) {
        completeLine.style.display = completeLine.style.display === 'flex' ? 'none' : 'flex';
        
        const icon = this.querySelector('i');
        if (icon.classList.contains('fa-chevron-right')) {
          icon.classList.replace('fa-chevron-right', 'fa-chevron-down');
        } else {
          icon.classList.replace('fa-chevron-down', 'fa-chevron-right');
        }
      }
    });
  });

  // Filter and sort functionality
  const applyFiltersBtn = document.getElementById('apply-filters');
  
  applyFiltersBtn.addEventListener('click', function() {
    const query = document.getElementById('query-input').value.toLowerCase();
    const dateFrom = document.getElementById('date-from').value;
    const dateTo = document.getElementById('date-to').value;
    const sortMethod = document.getElementById('sort-select').value;
    
    // This would be replaced with actual filtering logic
    console.log('Applying filters:', { query, dateFrom, dateTo, sortMethod });
    
    // Here you would typically:
    // 1. Parse the query string (key:value pairs with logical operators)
    // 2. Apply date range filtering
    // 3. Sort the results
    // 4. Update the UI
    
    alert('Filter functionality would be implemented here');
  });
  
  // Initialize date inputs with reasonable defaults
  const now = new Date();
  const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
  
  document.getElementById('date-from').valueAsDate = oneWeekAgo;
  document.getElementById('date-to').valueAsDate = now;
});
</script>
{% endblock %}